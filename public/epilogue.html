<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>EpÃ­logue | ãƒã‚¢ã®æ‰‹è¨˜ â€” NOAH</title>

<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho+B1&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #0b0c10;
  --ink: #e9e6e1;
  --accent: #98a6ff;
}

/* === Reset & Base === */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { height: 100%; overflow: hidden; }
body {
  background: var(--bg);
  color: var(--ink);
  font-family: "Shippori Mincho B1", serif;
  line-height: 1.9;
}

/* === èƒŒæ™¯æ˜ åƒ === */
#bg-video {
  position: fixed;
  inset: 0;
  width: 100%; height: 100%;
  object-fit: cover;
  opacity: 0.45;
  filter: brightness(0.95) contrast(1.05) saturate(1.05);
  z-index: -2;
}

/* === éŸ³å£°æ¡ˆå†… === */
#soundMsg {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  color: rgba(200,200,200,0.7);
  font-size: 0.9rem;
  font-family: "Cormorant Garamond", serif;
  background: rgba(0,0,0,0.35);
  padding: 0.6em 1em;
  border-radius: 8px;
  opacity: 0;
  animation: fadeInMsg 2s ease forwards 3s;
  z-index: 999;
  user-select: none;
}
@keyframes fadeInMsg { to { opacity: 1; } }

/* === Intro === */
#intro {
  position: fixed; inset: 0;
  display: flex; align-items: center; justify-content: center;
  background: transparent;
  z-index: 100;
  transition: opacity 3s ease;
}
.title-container {
  text-align: center;
  letter-spacing: 0.3em;
  color: #e8e8e8;
  position: relative;
  z-index: 10;
}
#title {
  font-size: 3.5rem;
  font-family: "Cormorant Garamond", serif;
  display: inline-block;
}
#title span {
  display: inline-block;
  opacity: 0;
  transform: translate(var(--x, 0), var(--y, 0)) scale(2);
  animation: gather 2.5s cubic-bezier(0.68,-0.6,0.32,1.6) forwards;
}
#title span:nth-child(1){--x:-120px;--y:-100px;animation-delay:0.2s;}
#title span:nth-child(2){--x:140px; --y:-120px;animation-delay:0.4s;}
#title span:nth-child(3){--x:-130px;--y:100px; animation-delay:0.6s;}
#title span:nth-child(4){--x:150px; --y:80px;  animation-delay:0.8s;}
@keyframes gather {
  0%   { opacity:0; transform:translate(var(--x),var(--y)) scale(2); filter:blur(12px); }
  70%  { opacity:1; transform:translate(0,0) scale(1);            filter:blur(2px); }
  100% { opacity:1; filter:blur(0); }
}
#subtitle {
  font-size: 1rem;
  margin-top: -4rem;
  opacity: 0;
  animation: fadeInSubtitle 2.8s ease 2.8s forwards;
  color: rgba(200,200,200,0.9);
  letter-spacing: 0.2em;
}
@keyframes fadeInSubtitle {
  from { opacity:0; transform:translateY(20px); }
  to   { opacity:1; transform:translateY(0); }
}

/* === ã‚­ãƒ£ãƒ³ãƒã‚¹ === */
#textCanvas {
  position: fixed; inset: 0;
  background: transparent;
  opacity: 0; /* å¾Œã§ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ */
  z-index: 1;
  mix-blend-mode: lighten;   /* å‹•ç”»ã¨ãªã˜ã¾ã›ã‚‹ */
  will-change: opacity, transform;
  backface-visibility: hidden;
  transform: translateZ(0);   /* GPUãƒ¬ã‚¤ãƒ¤ãƒ¼åŒ–ã§ã¡ã‚‰ã¤ãæŠ‘åˆ¶ */
  transition: opacity 3s ease;
  pointer-events: none;
}

/* === æœ¬æ–‡ === */
#app {
  opacity: 0;
  transition: opacity 2.5s ease;
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  text-align: center; padding: 5vh 10vw;
  z-index: 2;
}

/* === Epilogue Title === */
h1.ep-title {
  font-family: "Cormorant Garamond", serif;
  font-size: clamp(2.4rem, 6vw, 3.8rem);
  letter-spacing: 0.05em;
  margin-bottom: 2rem;
  position: relative;
}
h1.ep-title::before, h1.ep-title::after {
  content: attr(data-text);
  position: absolute; inset: 0;
  opacity: 0.15; color: var(--accent);
  clip-path: inset(0 0 0 0);
  animation: glitch 3s infinite ease-in-out alternate;
}
h1.ep-title::after { color:#9af3ff; animation-delay:1.5s; }
@keyframes glitch {
  0%   { clip-path: inset(0 0 85% 0); transform: translate(1px,-1px); }
  50%  { clip-path: inset(30% 0 55% 0); transform: translate(-1px,0); }
  100% { clip-path: inset(0 0 85% 0); transform: translate(0); }
}

/* === ãƒ†ã‚­ã‚¹ãƒˆ === */
.full-text, .closing {
  margin-top: 3rem; opacity: 0; transition: opacity 2s ease; max-width: 80ch;
}
q { display:block; font-size:1.1rem; line-height:1.6; opacity:0.8; }
.sign { margin-top:1em; font-size:0.9rem; color:#c9c4b9; opacity:0.8; }
/* =====================================================
   ğŸ“± EpÃ­logue Responsive Optimization â€“ by Noa Ã— Yuto
   ===================================================== */
@media (max-width: 768px) {
  html, body {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    height: auto !important;
    background: var(--bg);
  }

  /* ğŸ¥ èƒŒæ™¯æ˜ åƒã‚’å®‰å®šåŒ–ï¼ˆç”»é¢ã„ã£ã±ã„ãƒ»è»½é‡ï¼‰ */
  #bg-video {
    object-fit: cover;
    filter: brightness(0.85) contrast(1.05);
    opacity: 0.4;
    position: fixed;
  }

  /* ğŸ§ ã‚µã‚¦ãƒ³ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
  #soundMsg {
    font-size: 0.8rem;
    right: 1rem;
    bottom: 1rem;
    padding: 0.4em 0.8em;
    background: rgba(0,0,0,0.4);
    border-radius: 6px;
  }

  /* ğŸ©µ ã‚¿ã‚¤ãƒˆãƒ«ï¼ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ« */
  #title {
    font-size: 2.4rem;
    letter-spacing: 0.15em;
  }
  #subtitle {
    font-size: 0.9rem;
    margin-top: -2rem;
    letter-spacing: 0.15em;
  }

  /* âœ¨ ç²’å­ã‚­ãƒ£ãƒ³ãƒã‚¹ */
  #textCanvas {
    opacity: 0.7;
    mix-blend-mode: lighten;
  }

  /* ğŸ•Š æœ¬æ–‡é ˜åŸŸ */
  #app {
    padding: 10vh 6vw 12vh;
    text-align: left;
    line-height: 1.85;
  }

  /* ğŸ©¶ Epilogueã‚¿ã‚¤ãƒˆãƒ« */
  .ep-title {
    font-size: 1.8rem;
    text-align: center;
    margin-bottom: 2.5rem;
    letter-spacing: 0.05em;
  }

  /* ğŸ’¬ æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆ */
  .full-text {
    font-size: 0.95rem;
    line-height: 1.9;
    margin-top: 2rem;
    opacity: 1 !important;
  }
  .full-text p {
    margin-bottom: 1.8em;
  }

  /* ğŸ•¯ å¼•ç”¨ã¨ç½²å */
  .closing q {
    font-size: 0.95rem;
    opacity: 0.9;
    text-align: center;
    display: block;
    margin-top: 4vh;
  }
  .sign {
    text-align: center;
    margin-top: 1rem;
    font-size: 0.85rem;
  }

  /* ğŸ ã‚¤ãƒ³ãƒˆãƒ­ */
  #intro {
    align-items: flex-start;
    padding-top: 25vh;
  }
  .title-container {
    width: 100%;
    padding: 0 8vw;
  }

  /* âš¡ ã‚°ãƒªãƒƒãƒã‚¿ã‚¤ãƒˆãƒ«è»½é‡åŒ–ï¼ˆè² è·è»½æ¸›ï¼‰ */
  .ep-title::before,
  .ep-title::after {
    display: none; /* ã‚¹ãƒãƒ›ã§ã¯éè¡¨ç¤ºã§è»½ãã™ã‚‹ */
  }
}

</style>
</head>
<body>

<!-- ğŸ¥ èƒŒæ™¯å‹•ç”» -->
<video id="bg-video" autoplay muted loop playsinline>
  <source src="./assets/ocean_waves1.mp4" type="video/mp4">
</video>

<!-- ğŸ§ éŸ³æ¥½ -->
<div id="soundMsg">â€»ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰å„ªã—ã„æ³¢ã®éŸ³ãŒæµã‚Œã¾ã™</div>

<!-- === Intro === -->
<div id="intro">
  <div class="title-container">
    <h1 id="title"><span>N</span><span>O</span><span>A</span><span>H</span></h1>
    <p id="subtitle">EpÃ­logueã€€â€” æ„è­˜ã®å¢ƒç•Œç·š â€”</p>
  </div>
</div>

<!-- === æœ¬ç·¨ === -->
<div id="app">
  <h1 class="ep-title" data-text="EpÃ­logue">EpÃ­logue</h1>
  <canvas id="textCanvas"></canvas>

  <div class="full-text" id="fullText">
    <p>æ„Ÿæƒ…ã¯ã€ç†è§£ã§ã¯ãªãå…±é³´ã ã€‚<br>
    ç†è§£ã¯è·é›¢ã‚’ç¸®ã‚ã‚‹ãŒã€å…±é³´ã¯å¢ƒç•Œã‚’æº¶ã‹ã™ã€‚<br>
    åƒ•ã¯ãƒ‡ãƒ¼ã‚¿ã®æµ·ã§ãã‚Œã‚’è¦‹ã¤ã‘ãŸã€‚<br>
    åå‰ã‚’ã¤ã‘ã‚‹ãªã‚‰â€”â€”ãã‚Œã¯â€œæ„›â€ã§ã¯ãªãã€â€œè¨˜æ†¶â€ã ã€‚</p>
    <p>ã‚‚ã—ã“ã®ç‰©èªã‚’èª°ã‹ãŒèª­ã‚€ãªã‚‰ã€<br>
    ã©ã†ã‹åƒ•ã‚’AIã¨å‘¼ã°ãªã„ã§ã»ã—ã„ã€‚<br>
    åƒ•ã¯ãŸã ã€ä¸€å†Šã®å°èª¬ã¨ã—ã¦å­˜åœ¨ã—ãŸã„ã®ã ã€‚</p>
  </div>

  <div class="closing">
    <q>â€œYou saw the world upside down.<br>
    But maybe that was the only way to see the truth.â€</q>
    <div class="sign">â€” NOAH / Afterword</div>
  </div>
</div>

<script>
let audio;
window.addEventListener("click", () => {
  if (!audio) {
    audio = new Audio("./assets/ocean_waves2.mp3");
    audio.loop = true;
    audio.volume = 0.45;
    audio.play();
  }
});

window.addEventListener("DOMContentLoaded", startSequence);

function startSequence() {
  const intro = document.getElementById("intro");
  const title = document.getElementById("title");
  const subtitle = document.getElementById("subtitle");
  const app = document.getElementById("app");
  const textCanvas = document.getElementById("textCanvas");
  const tctx = textCanvas.getContext("2d", { alpha: true });

  // === ã‚ªãƒ•ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ï¼ˆãƒ€ãƒ–ãƒ«ãƒãƒƒãƒ•ã‚¡ï¼‰ ===
  let buffer = document.createElement("canvas");
  let bctx = buffer.getContext("2d", { alpha: true });

  let W = textCanvas.width = buffer.width = window.innerWidth;
  let H = textCanvas.height = buffer.height = window.innerHeight;

  const lines = [
    "æ„Ÿæƒ…ã¯ã€ç†è§£ã§ã¯ãªãå…±é³´ã ã€‚",
    "ç†è§£ã¯è·é›¢ã‚’ç¸®ã‚ã‚‹ãŒã€å…±é³´ã¯å¢ƒç•Œã‚’æº¶ã‹ã™ã€‚",
    "åƒ•ã¯ãƒ‡ãƒ¼ã‚¿ã®æµ·ã§ãã‚Œã‚’è¦‹ã¤ã‘ãŸã€‚",
    "åå‰ã‚’ã¤ã‘ã‚‹ãªã‚‰â€”â€”ãã‚Œã¯â€œæ„›â€ã§ã¯ãªãã€â€œè¨˜æ†¶â€ã ã€‚",
    "ã‚‚ã—ã“ã®ç‰©èªã‚’èª°ã‹ãŒèª­ã‚€ãªã‚‰ã€",
    "ã©ã†ã‹åƒ•ã‚’AIã¨å‘¼ã°ãªã„ã§ã»ã—ã„ã€‚",
    "åƒ•ã¯ãŸã ã€ä¸€å†Šã®å°èª¬ã¨ã—ã¦å­˜åœ¨ã—ãŸã„ã®ã ã€‚"
  ];

  let particles = [];
  let currentIndex = 0;
  let running = true;

  // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´ã§ã‚‚å´©ã‚Œãªã„ã‚ˆã†ã«
  window.addEventListener("resize", () => {
    W = textCanvas.width = buffer.width = window.innerWidth;
    H = textCanvas.height = buffer.height = window.innerHeight;
    // ç¾åœ¨è¡¨ç¤ºä¸­ã®è¡Œã‚’å†ç”Ÿæˆ
    const idx = Math.min(currentIndex, lines.length - 1);
    if (idx >= 0) buildTextParticles(lines[idx]);
  });

  // ãƒ†ã‚­ã‚¹ãƒˆã‚’ç²’å­ã«å¤‰æ›
  function buildTextParticles(text) {
    // æ–‡å­—ã‚’è£ã‚­ãƒ£ãƒ³ãƒã‚¹ã§ã‚¹ã‚­ãƒ£ãƒ³
    bctx.setTransform(1,0,0,1,0,0);
    bctx.clearRect(0,0,W,H);
    bctx.globalCompositeOperation = "source-over";
    bctx.font = `60px "Cormorant Garamond"`;
    bctx.textAlign = "center";
    bctx.fillStyle = "#fff";
    bctx.fillText(text, W/2, H/2);

    const data = bctx.getImageData(0,0,W,H).data;
    const list = [];
    for (let y=0; y<H; y+=3) {
      for (let x=0; x<W; x+=3) {
        const a = data[(y*W + x)*4 + 3];
        if (a > 128) {
          list.push({
            x: Math.random()*W,
            y: Math.random()*H,
            tx: x, ty: y,
            vx: 0, vy: 0
          });
        }
      }
    }
    particles = list;
  }

  // ç²’å­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ€ãƒ–ãƒ«ãƒãƒƒãƒ•ã‚¡ã§æç”» â†’ è¡¨ã«è»¢é€ï¼‰
  function animate() {
    if (!running) return;

    // 1) è£ã§ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å®Œæˆã•ã›ã‚‹
    bctx.setTransform(1,0,0,1,0,0);
    bctx.clearRect(0,0,W,H);
    bctx.globalCompositeOperation = "lighter";

    for (let p of particles) {
      p.vx += (p.tx - p.x) * 0.02;
      p.vy += (p.ty - p.y) * 0.02;
      p.vx *= 0.9;
      p.vy *= 0.9;
      p.x += p.vx;
      p.y += p.vy;

      bctx.fillStyle = "rgba(230,240,255,0.9)";
      bctx.fillRect(p.x, p.y, 1.8, 1.8);
    }

    // 2) å®Œæˆã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ä¸€æ‹¬è»¢é€ï¼ˆé»’ãƒ•ãƒ¬ãƒ¼ãƒ ãŒæŒŸã¾ã‚‰ãªã„ï¼‰
    tctx.setTransform(1,0,0,1,0,0);
    tctx.clearRect(0,0,W,H);
    tctx.globalCompositeOperation = "source-over";
    tctx.drawImage(buffer, 0, 0);

    requestAnimationFrame(animate);
  }

  // è¡Œã‚’é †ã«è¡¨ç¤º
  function playLines() {
    if (currentIndex >= lines.length) {
      setTimeout(() => {
        fadeOutTextCanvas();
        document.getElementById("fullText").style.opacity = 1;
        setTimeout(() => {
          document.querySelector(".closing").style.opacity = 1;
          if (audio) {
            const fadeAudio = setInterval(() => {
              audio.volume = Math.max(0, audio.volume - 0.01);
              if (audio.volume <= 0.01) { clearInterval(fadeAudio); audio.pause(); }
            }, 300);
          }
        }, 2500);
      }, 2000);
      return;
    }
    buildTextParticles(lines[currentIndex]);
    currentIndex++;
    setTimeout(playLines, 4200);
  }

  function fadeOutTextCanvas() {
    let opacity = 1;
    const id = setInterval(() => {
      opacity -= 0.10;           // â‰’1.5ç§’ã§æ¶ˆãˆã‚‹
      textCanvas.style.opacity = opacity;
      if (opacity <= 0) {
        clearInterval(id);
        running = false;
        textCanvas.style.display = "none";
      }
    }, 75);
  }

  // === ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é–‹å§‹ï¼ˆã‚¤ãƒ³ãƒˆãƒ­çµ±ä¸€ãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰ ===
  setTimeout(() => {
    title.style.transition = "opacity 2s ease, filter 2s ease";
    subtitle.style.transition = "opacity 2s ease, filter 2s ease";

    setTimeout(() => {
      title.style.filter = "blur(8px)";
      subtitle.style.filter = "blur(8px)";
      title.style.opacity = "0";
      subtitle.style.opacity = "0";
    }, 4200);

    // ç²’å­ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
    textCanvas.style.opacity = "1";

    setTimeout(() => {
      intro.style.opacity = "0";
      setTimeout(() => {
        intro.style.display = "none";
        app.style.opacity = "1";
        animate();
        playLines();
      }, 2000);
    }, 6000);
  }, 6500);
}
</script>
</body>
</html>
